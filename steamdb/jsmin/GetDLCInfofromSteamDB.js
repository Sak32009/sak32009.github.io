var GetDLCInfofromSteamDB={steamDB:{appID:"",appIDBg:"",appIDLogo:"",appIDName:"",configEXE:"",configARG:"",dlcs:{},dlcsTot:0,xml:null},script:{author:"Sak32009",name:"Get DLC Info from SteamDB",steamDB:"https://steamdb.info/app/",homepage:"https://sak32009.github.com/steamdb/",support:"http://cs.rin.ru/forum/viewtopic.php?f=10&t=71837"},yql:"https://query.yahooapis.com/v1/public/yql",format:{},options:{username:{title:"Username",type:"text",placeholder:"..."},game_language:{title:"Game Language",type:"text",placeholder:"english"},auto_download:{title:"Auto downloading file .INI when you click Get DLC List",type:"checkbox"},save_selection:{title:"Save the last selection of the format",type:"checkbox"},save_selection_getDLCList:{title:"When is checked (Save the last selection of the format) and you open the page, automatically submit Get DLC List",type:"checkbox"}},run:function(){GetDLCInfofromSteamDB.steamDB.appID=GetDLCInfofromSteamDB.getParam("appid"),GetDLCInfofromSteamDB.steamDB.appID!==!1&&GetDLCInfofromSteamDB.steamDB.appID.length&&$.isNumeric(GetDLCInfofromSteamDB.steamDB.appID)?(GetDLCInfofromSteamDB.overlay("Wait!"),GetDLCInfofromSteamDB.request(GetDLCInfofromSteamDB.yql,"SELECT * FROM html WHERE url='"+GetDLCInfofromSteamDB.script.steamDB+GetDLCInfofromSteamDB.steamDB.appID+"'",function(t){GetDLCInfofromSteamDB.steamDB.xml=t,GetDLCInfofromSteamDB.overlay(),GetDLCInfofromSteamDB.call()})):GetDLCInfofromSteamDB.alert("You must enter the appid this: <strong>"+GetDLCInfofromSteamDB.script.homepage+"?appid=ID</strong>")},call:function(){GetDLCInfofromSteamDB.getDataFromSteamDB(),GetDLCInfofromSteamDB.createStyles();var t=GetDLCInfofromSteamDB.steamDB.xml.find(".tabnav-tab[data-target='#dlc']");t.length?(GetDLCInfofromSteamDB.loadFormatList(),GetDLCInfofromSteamDB.tabGlobalOptions(),GetDLCInfofromSteamDB.submitOptions(),GetDLCInfofromSteamDB.loadOptions(),GetDLCInfofromSteamDB.loadCustomFormatList(),GetDLCInfofromSteamDB.eventsCustomFormatList(),GetDLCInfofromSteamDB.getDLCList()):GetDLCInfofromSteamDB.alert("This appID doesn't have DLCs!")},getDataFromSteamDB:function(){GetDLCInfofromSteamDB.steamDB.appIDLogo=GetDLCInfofromSteamDB.steamDB.xml.find("img.app-logo").attr("src"),GetDLCInfofromSteamDB.steamDB.appIDBg=GetDLCInfofromSteamDB.steamDB.xml.find(".header-app.header-wrapper").attr("style"),GetDLCInfofromSteamDB.steamDB.appIDName=GetDLCInfofromSteamDB.steamDB.xml.find("td[itemprop='name']").text().trim(),GetDLCInfofromSteamDB.steamDB.xml.find(".tab-pane#dlc .app[data-appid]").each(function(){var t=$(this),e=t.data("appid"),o=t.find("td:nth-of-type(2)").text().trim();GetDLCInfofromSteamDB.steamDB.dlcs[e]=o,GetDLCInfofromSteamDB.steamDB.dlcsTot++});var t=GetDLCInfofromSteamDB.steamDB.xml.find(".tab-pane#config > table:nth-of-type(1) tbody tr:nth-of-type(1)");GetDLCInfofromSteamDB.steamDB.configEXE=t.find("td:nth-of-type(2)").text().trim(),GetDLCInfofromSteamDB.steamDB.configARG=t.find("td:nth-of-type(3)").text().trim()},createStyles:function(){$("#header").attr("style",GetDLCInfofromSteamDB.steamDB.appIDBg),$("#GetDLCInfofromSteamDB_appIDHeader").attr("src",GetDLCInfofromSteamDB.steamDB.appIDLogo),$("*#GetDLCInfofromSteamDB_appID").text(GetDLCInfofromSteamDB.steamDB.appID),$("*#GetDLCInfofromSteamDB_appIDName").text(GetDLCInfofromSteamDB.steamDB.appIDName),$("*#GetDLCInfofromSteamDB_configEXE").text(GetDLCInfofromSteamDB.steamDB.configEXE),$("*#GetDLCInfofromSteamDB_configARG").text(GetDLCInfofromSteamDB.steamDB.configARG)},loadFormatList:function(){var t=$("#GetDLCInfoFromSteamDB_select");$.each(GetDLCInfofromSteamDB.format,function(e,o){var a=o.name,n=o.options;$("<option>").attr({value:e}).text(a).appendTo(t),Object.keys(n).length&&($("#GetDLCInfofromSteamDB_nav_tabs").append("<li class='nav-item'><a class='nav-link' data-toggle='tab' href='#"+e+"'>"+a+"</a></li>"),$("#GetDLCInfofromSteamDB_tab_content").append("<div class='tab-pane' id='"+e+"'>   <form id='GetDLCInfoFromSteamDB_submit_options'>       <div class='card-block'>           <button type='submit' class='btn btn-block btn-success'>Save Options</button>       </div>       <div class='table-responsive'>           <table class='table table-bordered m-b-0'><tbody>"+GetDLCInfofromSteamDB.htmlOptions(n)+"           </tbody></table>       </div>       <div class='card-block'>           <button type='submit' class='btn btn-block btn-success'>Save Options</button>       </div>   </form></div>"))}),$("#GetDLCInfofromSteamDB_nav_tabs .nav-item:first-child .nav-link").tab("show"),"true"==Storage.get("save_selection")&&Storage.check("save_selection_value")&&t.find("option[value='"+Storage.get("save_selection_value")+"']").prop("selected",!0)},tabGlobalOptions:function(){$(".GetDLCInfoFromSteamDB_globalOptions table > tbody").html(GetDLCInfofromSteamDB.htmlOptions(GetDLCInfofromSteamDB.options))},submitOptions:function(){$("form#GetDLCInfoFromSteamDB_submit_options").submit(function(t){t.preventDefault(),$(this).find("input, select").each(function(){var t=$(this),e=t.val(),o=t.attr("type"),a=t.attr("name");"checkbox"==o&&(e=t.prop("checked")),Storage.set(a,e)}),alert("Saved!")}),$("#GetDLCInfoFromSteamDB_resetOptions").click(function(t){t.preventDefault(),Storage.clear(),GetDLCInfofromSteamDB.loadOptions(),GetDLCInfofromSteamDB.loadCustomFormatList(),alert("Restored default options!")})},loadOptions:function(){$("form#GetDLCInfoFromSteamDB_submit_options").find("input, select").each(function(){var t=$(this),e=t.attr("type"),o=t.attr("name"),a=t.prop("tagName"),n=Storage.get(o);if("SELECT"==a){var m=Storage.check(n)?"value='"+n+"'":"selected";t.find("option["+m+"]").prop("selected",!0)}else"checkbox"==e?t.prop("checked","true"==n):t.val(n)})},loadCustomFormatList:function(){var t="",e=CustomFormat.all();$.each(e,function(e,o){var a=o.name,n=o.format;t+="<tr data-id='"+e+"'>    <td>"+a+"</td>    <td><textarea class='form-control' rows='1'>"+n+"</textarea></td>    <td><button type='button' class='btn btn-sm btn-info' id='GetDLCInfoFromSteamDB_customFormatView'>View</button></td>    <td><button type='button' class='btn btn-sm btn-success' id='GetDLCInfoFromSteamDB_customFormatSave'>Save</button></td>    <td><button type='button' class='btn btn-sm btn-danger' id='GetDLCInfoFromSteamDB_customFormatRemove'>Remove</button></td></tr>"}),$("#GetDLCInfoFromSteamDB_customFormatList table tbody").html(t)},eventsCustomFormatList:function(){$("#GetDLCInfoFromSteamDB_customFormatNew form").submit(function(t){t.preventDefault();var e=$(this),o=e.find("input[name='name']"),a=e.find("textarea[name='format']"),n=o.val(),m=a.val();n.length&&m.length?(o.val(""),a.val(""),CustomFormat.add(n,m),GetDLCInfofromSteamDB.loadCustomFormatList(),alert("Added!")):alert("Input(s) empty")}),$(document).on("click","button#GetDLCInfoFromSteamDB_customFormatRemove",function(t){t.preventDefault();var e=$(this),o=e.closest("tr"),a=o.data("id");CustomFormat.remove(a),GetDLCInfofromSteamDB.loadCustomFormatList(),alert("Removed!")}),$(document).on("click","button#GetDLCInfoFromSteamDB_customFormatSave",function(t){t.preventDefault();var e=$(this),o=e.closest("tr"),a=o.data("id"),n=o.find("textarea");n.length?(CustomFormat.save(a,n.val()),GetDLCInfofromSteamDB.loadCustomFormatList(),alert("Saved!")):alert("Input(s) empty")}),$(document).on("click","button#GetDLCInfoFromSteamDB_customFormatView",function(t){t.preventDefault();var e=$(this),o=e.closest("tr"),a=o.data("id"),n=CustomFormat.get(a),m=$("#GetDLCInfoFromSteamDB_customFormatViewModal");m.find(".modal-title").text(n.name),m.find(".modal-body textarea").val(GetDLCInfofromSteamDB.dlcFormatsStr(n.format)),m.modal("show")})},getDLCList:function(){var t=$("#GetDLCInfoFromSteamDB_submit");t.submit(function(t){t.preventDefault();var e=$(this),o="",a=e.find("#GetDLCInfoFromSteamDB_select option:selected"),n=a.val(),m=GetDLCInfofromSteamDB.format[n],r=m.name,f=m.ini,s=m.data;o+="; "+GetDLCInfofromSteamDB.script.name+" by "+GetDLCInfofromSteamDB.script.author+"\n; Format: "+r+"\n; AppID: "+GetDLCInfofromSteamDB.steamDB.appID+"\n; AppID Name: "+GetDLCInfofromSteamDB.steamDB.appIDName+"\n; Total DLCs: "+GetDLCInfofromSteamDB.steamDB.dlcsTot+"\n; SteamDB: "+GetDLCInfofromSteamDB.script.steamDB+GetDLCInfofromSteamDB.steamDB.appID+"\n; Website: "+GetDLCInfofromSteamDB.script.homepage+"?appid="+GetDLCInfofromSteamDB.steamDB.appID+"\n; Support: "+GetDLCInfofromSteamDB.script.support+"\n\n",o+=GetDLCInfofromSteamDB.dlcFormatsStr(s),$("#GetDLCInfoFromSteamDB_ini").attr({href:Download.data(o),download:f}),$("#GetDLCInfoFromSteamDB_textarea").text(o),"true"==Storage.get("auto_download")&&document.getElementById("GetDLCInfoFromSteamDB_ini").click(),"true"==Storage.get("save_selection")&&Storage.set("save_selection_value",n)}),"true"==Storage.get("save_selection")&&"true"==Storage.get("save_selection_getDLCList")&&t.trigger("submit")},htmlOptions:function(t){var e="";return $.each(t,function(t,o){var a=o.title,n=o.type;if(e+="<tr><td>"+a+"</td><td>","text"==n){var m=o.placeholder;e+="<input type='text' class='form-control' name='"+t+"' placeholder='"+m+"'>"}else if("checkbox"==n)e+="<input type='checkbox' name='"+t+"'>";else if("select"==n){var r=o.options,f=o["default"];e+="<select class='form-control' name='"+t+"'>",$.each(r,function(t,o){var a=t==f?"selected":"";e+="<option value='"+t+"' "+a+">"+o+"</option>"}),e+="</select>"}e+="</td></tr>"}),e},dlcEach:function(t,e,o,a){var n="",m=e?0:-1;return $.each(GetDLCInfofromSteamDB.steamDB.dlcs,function(e,r){m++,n+=GetDLCInfofromSteamDB.dlcEachFormat(t,{dlc_id:e,dlc_name:r,dlc_index:GetDLCInfofromSteamDB.dlcIndexFormat(m,o,a)})}),n},dlcIndexFormat:function(t,e,o){if(e){var a="0".repeat(o||3),n=a.length-t.toString().length;return n>0?a.substring(0,n)+t:t}return t},dlcEachFormat:function(t,e){return $.each(e,function(e,o){var a=new RegExp("{"+e+"}","g");t=t.replace(a,o)}),t},dlcFormatsStr:function(t){var e=t.match(/\[(\w+)(?:\=(.*))?\]([^\[]+)\[\/(\w+)\]/g);return null!==e&&e.length&&$.each(e,function(e,o){var a=/\[(\w+)(?:\=(.*))?\]([^\[]+)\[\/(\w+)\]/g.exec(o);if(null!==a&&a.length){var n=a[1],m=a[2],r=a[3],f=a[4];if(n==f&&r.length){var s="undefined"!=typeof m?m.split(":"):[];switch(n){case"steamdb":r in GetDLCInfofromSteamDB.steamDB&&(t=t.replace(o,GetDLCInfofromSteamDB.steamDB[r]));break;case"option":s.length&&(t=t.replace(o,Storage.getDef(r,s[0])));break;case"dlcEach":t=t.replace(o,GetDLCInfofromSteamDB.dlcEach(r,"true"==s[0],"true"==s[1],s[2]||0))}}}}),t},getParam:function(t){for(var e=window.location.search.substr(1),o=e.split("?"),a=0;a<o.length;a++){var n=o[a].split("="),m=n[0],r=n[1];if(m==t)return decodeURIComponent(r)}return!1},request:function(t,e,o){$.get(t,{q:e,format:"xml"},function(t){o($(t))})},overlay:function(t){"undefined"!=typeof t?$(".overlay").show().find(".overlay-text").text(t):$(".overlay").hide()},alert:function(t){$("#main").html("<div class='alert alert-danger m-a-2'>"+t+"</div>")}},Download={data:function(t){return"data:text/plain;charset=utf-8,"+encodeURIComponent(t)}},Storage={prefix:"GetDLCInfoFromSteamDB_",get:function(t){return window.localStorage.getItem(this.prefix+t)},getDef:function(t,e){var o=Storage.get(t);return Storage.check(o)?o:e},set:function(t,e){return window.localStorage.setItem(this.prefix+t,e)},remove:function(t){return window.localStorage.removeItem(this.prefix+t)},clear:function(){window.localStorage.clear()},check:function(t){return null!==t&&t.length}},CustomFormat={all:function(){var t=Storage.get("custom_format");return Storage.check(t)?JSON.parse(t):{}},set:function(t){Storage.set("custom_format",JSON.stringify(t))},get:function(t){var e=this.all();return e[t]},add:function(t,e){var o=this.all(),a="custom_format_"+(new Date).getTime();o[a]={name:t,format:e},this.set(o)},save:function(t,e){var o=this.all();t in o&&(o[t].format=e,this.set(o))},remove:function(t){var e=this.all();t in e&&(delete e[t],this.set(e))}};
