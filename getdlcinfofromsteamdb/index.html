<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Get DLC Info from SteamDB - Sak32009</title>
        <!-- BASE -->
        <base href="https://sak32009.github.io/getdlcinfofromsteamdb/" />
        <!-- BOOTSTRAP -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.1/css/bulma.min.css" integrity="sha512-ZRv40llEogRmoWgZwnsqke3HNzJ0kiI0+pcMgiz2bxO6Ew1DVBtWjVn0qjrXdT3+u+pSN36gLgmJiiQ3cQtyzA==" crossorigin="anonymous" />
        <!-- FONTAWESOME -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
        <!-- FONT-ROBOTO -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" crossorigin="anonymous" />
        <!-- CORNER -->
        <link rel="stylesheet" href="https://rawcdn.githack.com/Sak32009/sak32009.github.io/5760c3bc107c72654bdd2575f1f071c895c20e96/corner.css" crossorigin="anonymous" />
        <!-- BULMA PAGELOADER -->
        <link rel="stylesheet" href="https://rawcdn.githack.com/Wikiki/bulma-pageloader/e06c282aa0d0de5d8684e33f2402b02603cde0cd/dist/css/bulma-pageloader.min.css" crossorigin="anonymous" />
        <!-- MAIN -->
        <style>html, .pageloader{background-color:#4b2e52;}</style>
    </head>
    <body>
        <div class="pageloader is-active">
            <div class="title">
                <div class="has-text-centered">Please be patient!</div>
                <div id="pageloader_error" class="has-text-centered"></div>
                <a href="https://github.com/Sak32009/GetDLCInfoFromSteamDB/" class="button is-warning mt-1 is-block">
                    <span class="icon">
                        <i class="fas fa-question-circle"></i>
                    </span>
                    <span>Support Page</span>
                </a>
            </div>
        </div>
        <a href="https://github.com/Sak32009/GetDLCInfoFromSteamDB/" class="github-corner">
            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 250 250" fill="#fff" style="position: absolute; top: 0; right: 0;">
                <path d="M0 0l115 115h15l12 27 108 108V0z" fill="#000" />
                <path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin: 130px 106px; transform-origin: 130px 106px;" />
                <path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z" />
            </svg>
        </a>
        <div class="container">
            <div class="card my-3">
                <div class="card-content p-0">
                    <div class="has-text-centered p-5">
                        <figure class="image is-128x128" style="margin: auto;">
                            <img src="https://rawcdn.githack.com/Sak32009/sak32009.github.io/5760c3bc107c72654bdd2575f1f071c895c20e96/sak32009.svg" alt="Logo" style="height: 128px;" />
                        </figure>
                        <h2 class="is-size-2">Get DLC Info from SteamDB <b>v<span data-userscript="version">?</span></b></h2>
                    </div>
                    <div class="field has-addons m-0">
                        <p class="control is-expanded has-icons-left">
                            <span class="select is-fullwidth">
                                <select id="select"></select>
                            </span>
                            <span class="icon is-small is-left">
                                <i class="fas fa-angle-double-right"></i>
                            </span>
                        </p>
                        <p class="control">
                            <button id="convert" class="button is-success" type="button">
                                <span class="icon">
                                    <i class="fas fa-sync-alt"></i>
                                </span>
                                <span>Convert</span>
                            </button>
                        </p>
                        <p class="control">
                            <label class="button is-info checkbox"><input id="unknowns" type="checkbox"/> With DLCS Unknowns</label>
                        </p>
                        <p class="control">
                            <a id="download" href="javascript:;" class="button is-primary">
                                <span class="icon">
                                    <i class="fas fa-file-download"></i>
                                </span>
                                <span>Download as file</span>
                            </a>
                        </p>
                        <p class="control">
                            <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=U7TLCVMHN9HA2&amp;source=url" class="button is-danger" target="_blank">
                                <span class="icon">
                                    <i class="fab fa-paypal"></i>
                                </span>
                                <span>PayPal</span>
                            </a>
                        </p>
                    </div>
                    <div class="field">
                        <div class="control">
                            <textarea id="textarea" class="textarea" rows="20" placeholder="Select an option and click 'Convert'" style="border: 0; resize: none;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer has-text-centered">
            <div class="columns">
                <div class="column is-4">
                    <h4><b>Made</b> by <a href="https://github.com/Sak32009/" target="_blank">Sak32009</a> | <span data-userscript="year">?</span>.</h4>
                </div>
                <div class="column is-4">
                    <h4><b>Contribute</b> on <a href="https://github.com/Sak32009/GetDLCInfoFromSteamDB/"><i class="fab fa-github"></i> <span>GitHub</span></a></h4>
                </div>
                <div class="column is-4">
                    <h4><strong>Protect</strong> development and free things,<br>because their survival is in our hands.</h4>
                </div>
            </div>
            <h4>Source code licensed <a href="https://opensource.org/licenses/mit-license.php" target="_blank">MIT</a>.</h4>
        </footer>
        <!-- JQUERY -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
        <!-- MAIN -->
        <script>/*! Get DLC Info from SteamDB | MIT License | sak32009.github.io/getdlcinfofromsteamdb/ */
class m {
    constructor() {
        this.win = window.getdlcinfofromsteamdb;
        this.data = this.win.data;
        this.steamDB = this.win.steamDB;
        this.userscript = this.win.userscript;
    }
    run() {
        const self = this;
        self.fillInterface();
        self.loadEvents();
    }
    fillInterface() {
        const self = this;
        $("*[data-userscript='version']").text(self.userscript.script.version);
        $("*[data-userscript='year']").text(self.userscript.script.year);
        $.each(self.data, (_index, _values) => {
            const name = _values.name;
            $("<option>").attr("value", _index).text(name).appendTo(`select#select`);
        });
    }
    loadEvents() {
        const self = this;
        $(document).on("click", `button#convert`, (e) => {
            e.preventDefault();
            let result = "";
            const selected = $(`select#select option:selected`).val();
            const withDLCSUnknowns = $("input#unknowns").is(":checked");
            const data = self.data[selected];
            const name = data.name;
            const headerComment = data.header.comment;
            if (data.header.show) {
                result = `${self.userscript.script.name} by ${self.userscript.script.author} v${self.userscript.script.version} | ${self.userscript.script.year}
Format: ${name}
AppID: ${self.steamDB.appID}
AppID Name: ${self.steamDB.name}
AppID Total DLCS: ${self.steamDB.count}
AppID Total DLCS Unknowns: ${self.steamDB.countUnknowns}
SteamDB: ${self.steamDB.appURL}${self.steamDB.appID}
Homepage: ${self.userscript.script.homepage}
Support: ${self.userscript.script.supportURL}`;
                result = `${headerComment + result.split("\n").join(`\n${headerComment}`)}\n\n`;
            }
            result += self.bbcode(data.file.text, withDLCSUnknowns);
            const file = self.toBlob(self.bbcode(data.file.name, false), result, data.file.ext);
            $(`textarea#textarea`).html(result).scrollTop(0);
            $(`a#download`).attr({
                href: file.blob,
                download: file.name
            });
        });
    }
    toBlob(name, content, extension) {
        return {
            name: `${name.toString().length > 0 ? name : Math.random().toString(36).substring(2)}.${extension}`,
            blob: window.URL.createObjectURL(new Blob([content.replace(/\n/g, "\r\n")], {
                type: "application/octet-stream;charset=utf-8"
            }))
        };
    }
    bbcodeDLCSReplace(str, values) {
        $.each(values, (_index, _values) => {
            str = str.replace(new RegExp(`{${_index}}`, "g"), _values);
        });
        return str;
    }
    bbcodeDLCSPrefix(index, prefix) {
        return prefix > index.length ? "0".repeat(prefix - index.length) + index : index;
    }
    bbcodeDLCS(str, indexFromZero, indexPrefix, withDLCSUnknowns) {
        const self = this;
        let result = "";
        let index = indexFromZero ? 0 : -1;
        const dlcs = withDLCSUnknowns ? {
            ...self.steamDB.dlcs,
            ...self.steamDB.dlcsUnknowns
        } : self.steamDB.dlcs;
        $.each(dlcs, (_appid, _name) => {
            index += 1;
            result += self.bbcodeDLCSReplace(str, {
                "dlc_id": _appid,
                "dlc_name": _name,
                "dlc_index": self.bbcodeDLCSPrefix(index.toString(), parseInt(indexPrefix))
            });
        });
        return result;
    }
    bbcode(str, withDLCSUnknowns) {
        const self = this;
        let data = "";
        const re = /\[(\w+)(?:=(.*))?]([^[]+)\[\/(\w+)]/g;
        while ((data = re.exec(str)) !== null) {
            const [bbcode, bbcodeOpen, bbcodeOpt, bbcodeVal, bbcodeClose] = data;
            if (bbcodeOpen == bbcodeClose) {
                const bbcodeOpts = typeof bbcodeOpt !== "undefined" ? bbcodeOpt.split(":") : [];
                switch (bbcodeOpen) {
                    case "steamdb": {
                        str = str.replace(bbcode, self.steamDB[bbcodeVal]);
                        break;
                    }
                    case "dlcs": {
                        str = str.replace(bbcode, self.bbcodeDLCS(bbcodeVal.replace(/\\n/g, "\n"), bbcodeOpts[0] == "true", bbcodeOpts[1] || 0, withDLCSUnknowns));
                        break;
                    }
                }
            }
        }
        return str;
    }
}

const intervalCheck = window.setInterval(() => {
    const userscript = window.getdlcinfofromsteamdb;
    if (typeof userscript != "undefined") {
        const url = new URL(window.location.href);
        const $_GET = new URLSearchParams(url.search);
        const appID = $_GET.get("appid").toString();
        if($_GET.has("appid") && appID.length && !isNaN(appID)){
            const run = new m().run();
            $(".pageloader").removeClass("is-active");
            window.clearInterval(intervalCheck);
        }else{
            $("#pageloader_error").text("Invalid appID!");
        }
    }else{
        $("#pageloader_error").text("If it takes too long, verify if the userscript is installed.");
    }
}, 1000);</script>
    </body>
</html>
